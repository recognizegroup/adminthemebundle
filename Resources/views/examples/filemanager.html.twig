{% extends 'RecognizeAdminThemeBundle::index.html.twig' %}
{% trans_default_domain 'filemanager' %}
{% block scripts %}
    {{ parent() }}

    <script type="text/javascript" src="{{ asset('bundles/recognizefilemanager/js/jstree.js') }}"></script>
    <script type="text/javascript" src="{{ asset('bundles/recognizefilemanager/js/FilemanagerEventHandler.js') }}"></script>
    <script type="text/javascript" src="{{ asset('bundles/recognizefilemanager/js/FileTree.js') }}"></script>
    <script type="text/javascript" src="{{ asset('bundles/recognizefilemanager/js/FilemanagerApi.js') }}"></script>
    <script type="text/javascript" src="{{ asset('bundles/recognizefilemanager/js/FileTreeView.js') }}"></script>
    <script type="text/javascript" src="{{ asset('bundles/recognizefilemanager/js/filemanager.jquery.js') }}"></script>
    <link rel="stylesheet" type="text/css" href="{{ asset('bundles/recognizefilemanager/themes/bootstrap/style.css') }}" />

{% endblock %}
{% block mainmenu %}{% include('RecognizeAdminThemeBundle::examples/components/menu-filemanager.html.twig') %}{% endblock %}
{% block content %}
<div class="filetree">
    <h2>Filemanager</h2>

    <div class="titlebar">
        <div class="row">
            <!-- Titlebar goes here -->
        </div>
    </div>
    <div class="row">
        <div class="directories col-sm-3 hidden-xs">
            <!-- Directories go here -->
        </div>
        <div class="mainview col-sm-9 col-xs-12">
            <div class="table-responsive">
                <table class="table table-striped table-hover table-bordered table-keyboard-nav">
                    <thead>
                        <tr>
                            <th tabindex="0" class="noselect tabfocus sort-by-filename">{{ 'file.name'|trans }} <i class="fa fa-caret-down pull-right"></i></th>
                            <th tabindex="0" class="noselect tabfocus sort-by-filesize">{{ 'file.size'|trans }} <i class="fa fa-caret-up pull-right"></i></th>
                            <th tabindex="0" class="noselect tabfocus sort-by-date">{{ 'file.date_modified'|trans }} <i class="fa fa-caret-up pull-right"></i></th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Content go here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        var filetree = $('.filetree').filemanager({ debug: true,
            api: { url: window.location.origin + "/admin/fileapi", startingDirectory: "" },
            elements: { title: '.titlebar .row', main: '.mainview tbody' },
            titledirectoryFormat: function( current_directory ){
                var up_icon = "<i class=\"fa fa-flip-horizontal fa-level-up pull-left\"></i>";
                var folder_icon = "<i class=\"fa fa-folder-open pull-left\"></i>";
                var icon = "";
                if( current_directory !== "" ){
                    icon = up_icon + folder_icon;
                }

                current_directory = "/" + current_directory;
                return "<a href=\"#\" class=\"col-sm-6 col-xs-12 btn btn-primary\">" + icon + "<span class=\"pull-left\">" + current_directory + "</span></a>";
            },

            searchelementFormat: function( element ){
                element.addClass('form-control');
                return $("<div class=\"search-col col-sm-3 col-xs-12\"></div>").append( element );
            },

            filerowFormat: function( file ){

                // Set the icon as a file or a directory
                var icon = "<i class=\"fa fa-file-o pull-left\"></i>";
                if( file.type == "dir" ){
                    icon = "<i class=\"fa fa-folder-open pull-left\"></i>";;
                }

                return "<tr tabindex=\"0\" class=\"noselect\"><td class=\"col-sm-3 col-xs-6\">" + icon + file.name + "</td><td class=\"col-xs-1\">" + file.size  + "</td><td class=\"col-xs-1\">" + file.date_modified  + "</td></tr>";
            },

            createdirectoryFormat: function(){
                var icon = '<i class="fa fa-plus-circle fa-lg">';
                return "<a href=\"#\" class=\"btn\">" + icon + " {{ 'create_directory'|trans }}</a>";
            },

            filePreviewFormat: function( file ){

                // Set the icon as a file or a directory
                var icon = "<i class=\"fa fa-file-o pull-left\"></i>";
                if( file.type == "dir" ){
                    icon = "<i class=\"fa fa-folder-open pull-left\"></i>";;
                }

                return "<div class=\"col-sm-2\">" + icon + file.name + "</div>";
            }
        });

        $('.sort-by-filename').on("click",function( event ){
            $( this ).children("i").toggleClass('fa-caret-up').toggleClass('fa-caret-down');
            filetree.data('tree').sortContent();
        });

        $('.sort-by-filesize').on("click",function( event ){
            $( this ).children("i").toggleClass('fa-caret-up').toggleClass('fa-caret-down');
            filetree.data('tree').sortContent(function(a, b){
                if(b.size < a.size ){
                    return -1;
                } else if(b.size > a.size ){
                    return 1;
                } else {
                    return 0;
                }
            });
        });

        $('.sort-by-date').on("click",function( event ){
            $( this ).children("i").toggleClass('fa-caret-up').toggleClass('fa-caret-down');
            filetree.data('tree').sortContent(function(a, b){
                if(a.date_modified > b.date_modified){
                    return -1;
                } else if(a.date_modified < b.date_modified){
                    return 1;
                } else {
                    return 0;
                }
            });
        });
    </script>
</div>
{% endblock %}